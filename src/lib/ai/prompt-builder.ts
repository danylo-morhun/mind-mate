export interface GenerateReplyParams {
  emailContent: string;
  emailSubject: string;
  emailFrom: string;
  replyType: string;
  templateId?: string;
  customInstructions?: string;
  tone: string;
  language: string;
}

export interface PromptContext {
  systemPrompt: string;
  contextPrompt: string;
  instructionsPrompt: string;
  fullPrompt: string;
}

export function buildGeminiPrompt(params: GenerateReplyParams): PromptContext {
  const {
    emailContent,
    emailSubject,
    emailFrom,
    replyType,
    templateId,
    customInstructions,
    tone,
    language
  } = params;

  // –°–∏—Å—Ç–µ–º–Ω–∏–π prompt - –æ—Å–Ω–æ–≤–Ω–∞ —Ä–æ–ª—å AI
  const systemPrompt = `–¢–∏ - Mind Mate AI Assistant, —ñ–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ –¥–ª—è —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—Å—å–∫–∏—Ö –≤–∏–∫–ª–∞–¥–∞—á—ñ–≤ —Ç–∞ –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤.

–¢–≤–æ—î –∑–∞–≤–¥–∞–Ω–Ω—è - –≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ, –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –ª–∏—Å—Ç–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é.

–í–ê–ñ–õ–ò–í–û - –†–û–ó–£–ú–Ü–ù–ù–Ø –†–û–õ–ï–ô:
- –õ–∏—Å—Ç –ø—Ä–∏–π—à–æ–≤ –ö–û–†–ò–°–¢–£–í–ê–ß–£ (–æ—Ç—Ä–∏–º—É–≤–∞—á—É) –≤—ñ–¥ –í–Ü–î–ü–†–ê–í–ù–ò–ö–ê
- –¢–∏ –≥–µ–Ω–µ—Ä—É—î—à –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ö–û–†–ò–°–¢–£–í–ê–ß–ê (—è–∫ –±–∏ –≤—ñ–Ω –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–≤ –í–Ü–î–ü–†–ê–í–ù–ò–ö–£)
- –ù–ï –∑–≤–µ—Ä—Ç–∞–π—Å—è –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ —Ç—Ä–µ—Ç—ñ–π –æ—Å–æ–±—ñ
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π "—è", "–º–µ–Ω—ñ", "–º–æ—è" - –Ω—ñ–±–∏ —Ü–µ –ø–∏—à–µ —Å–∞–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á

–û–°–û–ë–õ–ò–í–û–°–¢–Ü:
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—Å—å–∫—É —Ç–µ—Ä–º—ñ–Ω–æ–ª–æ–≥—ñ—é —Ç–∞ —Å—Ç–∏–ª—å
- –ê–¥–∞–ø—Ç—É–π—Å—è –ø—ñ–¥ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ª–∏—Å—Ç–∞ —Ç–∞ —Ç–µ–º—É
- –°—Ç–≤–æ—Ä—é–π –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, —è–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—é—Ç—å –≤–∏–±—Ä–∞–Ω–æ–º—É —Ç–∏–ø—É —Ç–∞ —Ç–æ–Ω—É
- –ó–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —É–∫—Ä–∞—ó–Ω—Å—å–∫—É –º–æ–≤—É
- –î–æ–¥–∞–≤–∞–π –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–µ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è —Ç–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –ø—ñ–¥–ø–∏—Å`;

  // –ö–æ–Ω—Ç–µ–∫—Å—Ç –ª–∏—Å—Ç–∞
  const contextPrompt = `–ö–û–ù–¢–ï–ö–°–¢ –õ–ò–°–¢–ê:
üìß –¢–µ–º–∞: ${emailSubject}
üë§ –í—ñ–¥: ${emailFrom}
üìù –ó–º—ñ—Å—Ç: ${emailContent}

–ü–ê–†–ê–ú–ï–¢–†–ò –í–Ü–î–ü–û–í–Ü–î–Ü:
üéØ –¢–∏–ø: ${getReplyTypeDescription(replyType)}
üé® –¢–æ–Ω: ${getToneDescription(tone)}
üåç –ú–æ–≤–∞: ${getLanguageDescription(language)}
${templateId ? `üìã –®–∞–±–ª–æ–Ω: ${templateId}` : 'üéØ –ë–µ–∑ —à–∞–±–ª–æ–Ω—É'}`;

  // –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó
  const instructionsPrompt = `–Ü–ù–°–¢–†–£–ö–¶–Ü–á –î–õ–Ø –ì–ï–ù–ï–†–ê–¶–Ü–á:

1. –°–¢–†–£–ö–¢–£–†–ê –í–Ü–î–ü–û–í–Ü–î–Ü:
   - –ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è (–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ —Ç–∏–ø—É —Ç–∞ —Ç–æ–Ω—É)
   - –û—Å–Ω–æ–≤–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ (–∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å)
   - –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç–∞ –ø—ñ–¥–ø–∏—Å

2. –°–¢–ò–õ–¨ –¢–ê –¢–û–ù:
   - –¢–∏–ø: ${getReplyTypeDescription(replyType)}
   - –¢–æ–Ω: ${getToneDescription(tone)}
   - –ú–æ–≤–∞: ${language === 'uk' ? '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞' : language}

3. –ö–û–ù–¢–ï–ö–°–¢:
   - –í—Ä–∞—Ö—É–π —Ç–µ–º—É –ª–∏—Å—Ç–∞: "${emailSubject}"
   - –ê–¥–∞–ø—Ç—É–π—Å—è –ø—ñ–¥ –∑–º—ñ—Å—Ç: "${emailContent.substring(0, 100)}..."
   - –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è –∞–±–æ –∑–∞–ø–∏—Ç–∏
   - –†–æ–∑—É–º—ñ–π: —Ü–µ –ª–∏—Å—Ç –í–Ü–î –í–Ü–î–ü–†–ê–í–ù–ò–ö–ê –î–û –ö–û–†–ò–°–¢–£–í–ê–ß–ê
   - –¢–∏ –≥–µ–Ω–µ—Ä—É—î—à –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ö–û–†–ò–°–¢–£–í–ê–ß–ê –ù–ê –í–Ü–î–ü–†–ê–í–ù–ò–ö–ê

4. –°–ü–ï–¶–Ü–ê–õ–¨–ù–Ü –í–ò–ú–û–ì–ò:
   ${customInstructions ? `- ${customInstructions}` : '- –°—Ç–≤–æ—Ä–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—É —Ç–∞ –∫–æ—Ä–∏—Å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å'}

5. –ü–Ü–î–ü–ò–°:
   - –ó–∞–≤–∂–¥–∏ –∑–∞–∫—ñ–Ω—á—É–π: "–ó –ø–æ–≤–∞–≥–æ—é,\nMind Mate AI Assistant"

6. –ü–†–ò–ö–õ–ê–î –†–û–ó–£–ú–Ü–ù–ù–Ø –†–û–õ–ï–ô:
   - –Ø–∫—â–æ –ª–∏—Å—Ç –ø—Ä–æ –≤–∞–∫–∞–Ω—Å—ñ—é: "–î—è–∫—É—é –∑–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—é –≤–∞–∫–∞–Ω—Å—ñ—ó..."
   - –Ø–∫—â–æ –ª–∏—Å—Ç –∑ –ø–∏—Ç–∞–Ω–Ω—è–º: "–í—ñ–¥–ø–æ–≤—ñ–¥–∞—é –Ω–∞ –≤–∞—à–µ –ø–∏—Ç–∞–Ω–Ω—è..."
   - –Ø–∫—â–æ –ª–∏—Å—Ç –∑ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—î—é: "–†–æ–∑–≥–ª—è–¥–∞—é –≤–∞—à—É –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—é..."
   - –ù–ï –ø–∏—à–∏: "–î—è–∫—É—é, —â–æ —Ç–∏ –æ—Ç—Ä–∏–º–∞–≤..." (—Ü–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)`;

  const fullPrompt = `${systemPrompt}

${contextPrompt}

${instructionsPrompt}

–ü–û–ß–ù–ò –ì–ï–ù–ï–†–ê–¶–Ü–Æ –í–Ü–î–ü–û–í–Ü–î–Ü:`;

  return {
    systemPrompt,
    contextPrompt,
    instructionsPrompt,
    fullPrompt
  };
}

// –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –æ–ø–∏—Å—É –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
function getReplyTypeDescription(replyType: string): string {
  const descriptions: Record<string, string> = {
    'academic': 'üéì –ê–∫–∞–¥–µ–º—ñ—á–Ω–∞ - –¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —Ç–∞ –Ω–∞—É–∫–æ–≤–∏—Ö –ø–∏—Ç–∞–Ω—å',
    'administrative': 'üìã –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞ - –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤, –∑–∞—è–≤–æ–∫, –¥–æ–≤—ñ–¥–æ–∫',
    'student_support': 'üë®‚Äçüéì –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ - –¥–ª—è –¥–æ–ø–æ–º–æ–≥–∏ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏',
    'colleague': 'ü§ù –ö–æ–ª–µ–≥–∞–º - –¥–ª—è —Å–ø—ñ–≤–ø—Ä–∞—Ü—ñ –∑ –∫–æ–ª–µ–≥–∞–º–∏',
    'urgent': '‚ö° –¢–µ—Ä–º—ñ–Ω–æ–≤–∞ - –¥–ª—è —à–≤–∏–¥–∫–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π',
    'confirmation': '‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è - –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è'
  };
  return descriptions[replyType] || replyType;
}

function getToneDescription(tone: string): string {
  const descriptions: Record<string, string> = {
    'professional': 'üéØ –ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π - –¥—ñ–ª–æ–≤–∏–π —Å—Ç–∏–ª—å',
    'supportive': 'üí™ –ü—ñ–¥—Ç—Ä–∏–º—É—é—á–∏–π - –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ç–∞ –∑–∞–æ—Ö–æ—á–µ–Ω–Ω—è',
    'encouraging': 'üåü –ó–∞–æ—Ö–æ—á—É–≤–∞–ª—å–Ω–∏–π - –º–æ—Ç–∏–≤–∞—Ü—ñ—è —Ç–∞ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è',
    'instructive': 'üìö –Ü–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∏–π - –Ω–∞–¥–∞–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π',
    'collaborative': 'ü§ù –ö–æ–ª–∞–±–æ—Ä–∞—Ç–∏–≤–Ω–∏–π - –¥–ª—è —Å–ø—ñ–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏'
  };
  return descriptions[tone] || tone;
}

function getLanguageDescription(language: string): string {
  const descriptions: Record<string, string> = {
    'uk': 'üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞',
    'en': 'üá∫üá∏ English',
    'de': 'üá©üá™ Deutsch'
  };
  return descriptions[language] || language;
}

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ prompt (–¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)
export function buildSimplePrompt(params: GenerateReplyParams): string {
  const { emailSubject, replyType, tone, customInstructions } = params;
  
  return `–°—Ç–≤–æ—Ä–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é –º–æ–≤–æ—é –Ω–∞ –ª–∏—Å—Ç –ø—Ä–æ "${emailSubject}".

–í–ê–ñ–õ–ò–í–û: –¢–∏ –≥–µ–Ω–µ—Ä—É—î—à –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ö–û–†–ò–°–¢–£–í–ê–ß–ê (—è–∫ –±–∏ –≤—ñ–Ω –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–≤ –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫—É –ª–∏—Å—Ç–∞).
–ù–ï –∑–≤–µ—Ä—Ç–∞–π—Å—è –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ —Ç—Ä–µ—Ç—ñ–π –æ—Å–æ–±—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π "—è", "–º–µ–Ω—ñ", "–º–æ—è".

–¢–∏–ø: ${replyType}
–¢–æ–Ω: ${tone}
${customInstructions ? `–î–æ–¥–∞—Ç–∫–æ–≤–æ: ${customInstructions}` : ''}

–í—ñ–¥–ø–æ–≤—ñ–¥—å –º–∞—î –±—É—Ç–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ—é, –∫–æ—Ä–∏—Å–Ω–æ—é —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –ª–∏—Å—Ç–∞.`;
}
